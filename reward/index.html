<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image Puzzle Challenge</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, select, button { width: 100%; padding: 10px; margin: 10px 0; }
    .puzzle-container { display: grid; gap: 2px; margin-top: 20px; }
    .puzzle-piece { background-size: cover; cursor: move; width: 100%; height: 100%; }
    .puzzle-grid { aspect-ratio: 1 / 1; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Image Puzzle Challenge</h2>
    <label for="rewardUrl">Reward URL:</label>
    <input type="text" id="rewardUrl" placeholder="https://example.com/reward">

    <label for="imageUrl">Image URL:</label>
    <input type="text" id="imageUrl" placeholder="https://example.com/image.jpg">

    <label for="gridSize">Grid Size (e.g., 3 for 3x3):</label>
    <input type="number" id="gridSize" min="2" max="10" value="3">

    <button onclick="startPuzzle()">Start Puzzle</button>

    <div class="puzzle-container puzzle-grid" id="puzzleArea"></div>
    <p id="resultMessage"></p>
  </div>

  <script>
    let gridSize, rewardUrl, correctOrder = [], currentOrder = [];

    function startPuzzle() {
      const imageUrl = document.getElementById('imageUrl').value;
      rewardUrl = document.getElementById('rewardUrl').value;
      gridSize = parseInt(document.getElementById('gridSize').value);
      if (!imageUrl || !rewardUrl || isNaN(gridSize) || gridSize < 2) {
        alert("Please enter valid image URL, reward URL, and grid size (>= 2).");
        return;
      }
      generatePuzzle(imageUrl, gridSize);
    }

    function generatePuzzle(imageUrl, grid) {
      const puzzleArea = document.getElementById('puzzleArea');
      puzzleArea.innerHTML = '';
      puzzleArea.style.gridTemplateColumns = `repeat(${grid}, 1fr)`;
      puzzleArea.style.gridTemplateRows = `repeat(${grid}, 1fr)`;

      correctOrder = [];
      for (let i = 0; i < grid * grid; i++) correctOrder.push(i);
      currentOrder = [...correctOrder].sort(() => Math.random() - 0.5);

      currentOrder.forEach((val, index) => {
        const piece = document.createElement('div');
        piece.classList.add('puzzle-piece');
        piece.style.backgroundImage = `url(${imageUrl})`;
        piece.style.backgroundPosition = `${(val % grid) * -100 / (grid - 1)}% ${(Math.floor(val / grid)) * -100 / (grid - 1)}%`;
        piece.setAttribute('data-index', val);
        piece.setAttribute('draggable', true);

        piece.addEventListener('dragstart', dragStart);
        piece.addEventListener('dragover', e => e.preventDefault());
        piece.addEventListener('drop', drop);

        puzzleArea.appendChild(piece);
      });
    }

    let draggedIndex;
    function dragStart(e) {
      draggedIndex = Array.from(e.target.parentNode.children).indexOf(e.target);
    }

    function drop(e) {
      const dropIndex = Array.from(e.target.parentNode.children).indexOf(e.target);
      const puzzleArea = document.getElementById('puzzleArea');
      const children = Array.from(puzzleArea.children);
      puzzleArea.insertBefore(children[draggedIndex], children[dropIndex]);
      puzzleArea.insertBefore(children[dropIndex], children[draggedIndex + (draggedIndex < dropIndex ? 1 : 0)]);
      checkPuzzleSolved();
    }

    function checkPuzzleSolved() {
      const pieces = document.querySelectorAll('.puzzle-piece');
      const order = Array.from(pieces).map(p => parseInt(p.getAttribute('data-index')));
      if (order.every((val, i) => val === correctOrder[i])) {
        document.getElementById('resultMessage').innerHTML = `<strong>Puzzle Solved!</strong> Your reward: <a href="${rewardUrl}" target="_blank">Click here</a>`;
      } else {
        document.getElementById('resultMessage').innerText = '';
      }
    }
  </script>
</body>
</html>
